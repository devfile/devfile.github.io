(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9799],{69799:function(a){!function(c,b){a.exports=b()}(window,function(){return function(b){var c={};function a(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return b[d].call(e.exports,e,e.exports,a),e.l=!0,e.exports}return a.m=b,a.c=c,a.d=function(b,c,d){a.o(b,c)||Object.defineProperty(b,c,{enumerable:!0,get:d})},a.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},a.t=function(b,c){if(1&c&&(b=a(b)),8&c||4&c&&"object"==typeof b&&b&&b.__esModule)return b;var d=Object.create(null);if(a.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:b}),2&c&&"string"!=typeof b)for(var e in b)a.d(d,e,(function(a){return b[a]}).bind(null,e));return d},a.n=function(c){var b=c&&c.__esModule?function(){return c.default}:function(){return c};return a.d(b,"a",b),b},a.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.p="",a(a.s=2)}([function(d,a,b){"use strict";b.r(a);var c="function"==typeof fetch?fetch.bind():function(b,a){return a=a||{},new Promise(function(f,e){var c=new XMLHttpRequest;for(var d in c.open(a.method||"get",b,!0),a.headers)c.setRequestHeader(d,a.headers[d]);function g(){var a,b=[],d=[],e={};return c.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(g,c,f){b.push(c=c.toLowerCase()),d.push([c,f]),a=e[c],e[c]=a?a+","+f:f}),{ok:2==(c.status/100|0),status:c.status,statusText:c.statusText,url:c.responseURL,clone:g,text:function(){return Promise.resolve(c.responseText)},json:function(){return Promise.resolve(c.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([c.response]))},headers:{keys:function(){return b},entries:function(){return d},get:function(a){return e[a.toLowerCase()]},has:function(a){return a.toLowerCase() in e}}}}c.withCredentials="include"==a.credentials,c.onload=function(){f(g())},c.onerror=e,c.send(a.body)})};a.default=c},function(c,a,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=function(){function a(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),b=function(){function a(b,c){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),this.pluginName=b}return e(a,[{key:"track",value:function(a,b){window.analytics.track(a,b,{integration:{name:this.pluginName}})}}]),a}();a.default=b},function(e,a,b){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.YouTubeAnalytics=a.VimeoAnalytics=void 0;var c=f(b(3)),d=f(b(4));function f(a){return a&&a.__esModule?a:{default:a}}a.VimeoAnalytics=c.default,a.YouTubeAnalytics=d.default},function(e,a,b){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var f=function(){function a(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(b(0));function c(a){return a&&a.__esModule?a:{default:a}}var d=function(b){function a(c,d){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a);var b=function(b,a){if(!b)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:b}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,"VimeoAnalytics"));return b.authToken=d,b.player=c,b.metadata={content:{},playback:{videoPlayer:"Vimeo"}},b.mostRecentHeartbeat=0,b.isPaused=!1,b}return function(b,a){if("function"!=typeof a&&null!==a)throw TypeError("Super expression must either be null or a function, not "+typeof a);b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(b,a):b.__proto__=a)}(a,b),f(a,[{key:"initialize",value:function(){var c=this,a={loaded:this.retrieveMetadata,play:this.trackPlay,pause:this.trackPause,ended:this.trackEnded,timeupdate:this.trackHeartbeat};for(var b in a)this.registerHandler(b,a[b]);this.player.getVideoId().then(function(a){c.retrieveMetadata({id:a})}).catch(console.error)}},{key:"registerHandler",value:function(a,b){var c=this;this.player.on(a,function(a){c.updateMetadata(a),b.call(c,a)})}},{key:"trackPlay",value:function(){this.isPaused?(this.track("Video Playback Resumed",this.metadata.playback),this.isPaused=!1):(this.track("Video Playback Started",this.metadata.playback),this.track("Video Content Started",this.metadata.content))}},{key:"trackEnded",value:function(){this.track("Video Playback Completed",this.metadata.playback),this.track("Video Content Completed",this.metadata.content)}},{key:"trackHeartbeat",value:function(){var b=this.mostRecentHeartbeat,a=this.metadata.playback.position;a!==b&&a-b>=10&&(this.track("Video Content Playing",this.metadata.content),this.mostRecentHeartbeat=Math.floor(a))}},{key:"trackPause",value:function(){this.isPaused=!0,this.track("Video Playback Paused",this.metadata.playback)}},{key:"retrieveMetadata",value:function(a){var b=this;return new Promise(function(d,e){var c=a.id;(0,g.default)("https://api.vimeo.com/videos/"+c,{headers:{Authorization:"Bearer "+b.authToken}}).then(function(a){return a.ok?a.json():e(a)}).then(function(a){b.metadata.content.title=a.name,b.metadata.content.description=a.description,b.metadata.content.publisher=a.user.name,b.metadata.playback.position=0,b.metadata.playback.totalLength=a.duration}).catch(function(a){return console.error("Request to Vimeo API Failed with: ",a),e(a)})})}},{key:"updateMetadata",value:function(a){var b=this;return new Promise(function(d,c){b.player.getVolume().then(function(c){c&&(b.metadata.playback.sound=100*c),b.metadata.playback.position=a.seconds,d()}).catch(c)})}}]),a}(c(b(1)).default);a.default=d},function(e,a,b){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var f=function(){function a(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=h(b(0)),c=h(b(1));function h(a){return a&&a.__esModule?a:{default:a}}var d=function(b){function a(c,d){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a);var b=function(b,a){if(!b)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:b}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,"YoutubeAnalytics"));return b.player=c,b.apiKey=d,b.playerLoaded=!1,b.playbackStarted=!1,b.contentStarted=!1,b.isPaused=!1,b.isBuffering=!1,b.isSeeking=!1,b.lastRecordedTime={timeReported:Date.now(),timeElapsed:0},b.metadata=[{playback:{video_player:"youtube"},content:{}}],b.playlistIndex=0,b}return function(b,a){if("function"!=typeof a&&null!==a)throw TypeError("Super expression must either be null or a function, not "+typeof a);b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(b,a):b.__proto__=a)}(a,b),f(a,[{key:"initialize",value:function(){window.segmentYoutubeOnStateChange=this.onPlayerStateChange.bind(this),window.segmentYoutubeOnReady=this.onPlayerReady.bind(this),this.player.addEventListener("onReady","segmentYoutubeOnReady"),this.player.addEventListener("onStateChange","segmentYoutubeOnStateChange")}},{key:"onPlayerReady",value:function(a){this.retrieveMetadata()}},{key:"onPlayerStateChange",value:function(a){var b=this.player.getCurrentTime();switch(this.metadata[this.playlistIndex]&&(this.metadata[this.playlistIndex].playback.position=this.metadata[this.playlistIndex].content.position=b,this.metadata[this.playlistIndex].playback.quality=this.player.getPlaybackQuality(),this.metadata[this.playlistIndex].playback.sound=this.player.isMuted()?0:this.player.getVolume()),a.data){case -1:if(this.playerLoaded)break;this.retrieveMetadata(),this.playerLoaded=!0;break;case YT.PlayerState.BUFFERING:this.handleBuffer();break;case YT.PlayerState.PLAYING:this.handlePlay();break;case YT.PlayerState.PAUSED:this.handlePause();break;case YT.PlayerState.ENDED:this.handleEnd()}this.lastRecordedTime={timeReported:Date.now(),timeElapsed:1e3*this.player.getCurrentTime()}}},{key:"retrieveMetadata",value:function(){var a=this;return new Promise(function(e,f){var b=a.player.getVideoData(),c=a.player.getPlaylist()||[b.video_id],d=c.join();(0,g.default)("https://www.googleapis.com/youtube/v3/videos?id="+d+"&part=snippet,contentDetails&key="+a.apiKey).then(function(a){if(!a.ok){var b=Error("Segment request to Youtube API failed (likely due to a bad API Key. Events will still be sent but will not contain video metadata)");throw b.response=a,b}return a.json()}).then(function(g){a.metadata=[];for(var f=0,b=0;b<c.length;b++){var d=g.items[b];a.metadata.push({content:{title:d.snippet.title,description:d.snippet.description,keywords:d.snippet.tags,channel:d.snippet.channelTitle,airdate:d.snippet.publishedAt}}),f+=i(d.contentDetails.duration)}for(b=0;b<c.length;b++)a.metadata[b].playback={total_length:f,video_player:"youtube"};e()}).catch(function(b){a.metadata=c.map(function(a){return{playback:{video_player:"youtube"},content:{}}}),f(b)})})}},{key:"handleBuffer",value:function(){var b=this.determineSeek();this.playbackStarted||(this.playbackStarted=!0,this.track("Video Playback Started",this.metadata[this.playlistIndex].playback)),b&&!this.isSeeking&&(this.isSeeking=!0,this.track("Video Playback Seek Started",this.metadata[this.playlistIndex].playback)),this.isSeeking&&(this.track("Video Playback Seek Completed",this.metadata[this.playlistIndex].playback),this.isSeeking=!1);var a=this.player.getPlaylist();a&&0===this.player.getCurrentTime()&&this.player.getPlaylistIndex()!==this.playlistIndex&&(this.contentStarted=!1,this.playlistIndex===a.length-1&&0===this.player.getPlaylistIndex()&&(this.track("Video Playback Completed",this.metadata[this.player.getPlaylistIndex()].playback),this.track("Video Playback Started",this.metadata[this.player.getPlaylistIndex()].playback))),this.track("Video Playback Buffer Started",this.metadata[this.playlistIndex].playback),this.isBuffering=!0}},{key:"handlePlay",value:function(){this.contentStarted||(this.playlistIndex=this.player.getPlaylistIndex(),-1===this.playlistIndex&&(this.playlistIndex=0),this.track("Video Content Started",this.metadata[this.playlistIndex].content),this.contentStarted=!0),this.isBuffering&&(this.track("Video Playback Buffer Completed",this.metadata[this.playlistIndex].playback),this.isBuffering=!1),this.isPaused&&(this.track("Video Playback Resumed",this.metadata[this.playlistIndex].playback),this.isPaused=!1)}},{key:"handlePause",value:function(){var a=this.determineSeek();this.isBuffering&&(this.track("Video Playback Buffer Completed",this.metadata[this.playlistIndex].playback),this.isBuffering=!1),this.isPaused||(a?(this.track("Video Playback Seek Started",this.metadata[this.playlistIndex].playback),this.isSeeking=!0):(this.track("Video Playback Paused",this.metadata[this.playlistIndex].playback),this.isPaused=!0))}},{key:"handleEnd",value:function(){this.track("Video Content Completed",this.metadata[this.playlistIndex].content),this.contentStarted=!1;var a=this.player.getPlaylistIndex(),b=this.player.getPlaylist();(b&&a===b.length-1|| -1===a)&&(this.track("Video Playback Completed",this.metadata[this.playlistIndex].playback),this.playbackStarted=!1)}},{key:"determineSeek",value:function(){var a;return Math.abs((this.isPaused||this.isBuffering?0:Date.now()-this.lastRecordedTime.timeReported)-(1e3*this.player.getCurrentTime()-this.lastRecordedTime.timeElapsed))>2e3}}]),a}(c.default);function i(b){var a=b.match(/PT(\d+H)?(\d+M)?(\d+S)?/);return 3600*(parseInt((a=a.slice(1).map(function(a){if(null!=a)return a.replace(/\D/,"")}))[0])||0)+60*(parseInt(a[1])||0)+(parseInt(a[2])||0)}a.default=d}])})}}])